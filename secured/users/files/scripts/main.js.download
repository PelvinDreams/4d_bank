"use strict";function GlobalErrorHandler(){function t(t,e,n,i,o){t.target&&(t=t.target.outerHTML),o||(o={});try{$.post("/jsError",{message:t,url:e||o.fileName||location.href,line:n||o.lineNumber,column:i||o.columnNumber,userAgent:navigator.userAgent,stack:o.stack})}catch(t){console&&console.log(t)}$.mobile&&alert(a+": "+t)}function e(t,e,i){if(!(0==e.status||i&&i.suppressErrors)){var o=500==e.status?a:e.status+" "+e.statusText,r=e.getResponseHeader&&e.getResponseHeader("Content-Type");e.responseText&&r&&r.startsWith("text/plain")&&(o=e.responseText),window.alertOnAjaxError?alertOnAjaxError(o,i):navigator.notification&&navigator.notification.alert?navigator.notification.alert(o,function(){return n(e.status)},""):(alert(o),n(e.status))}}function n(t){403==t&&($.mobile?app.reset():location.href="/")}var a=window.app&&app.messages&&app.messages["error.technical"]||"Technical error";this.init=function(){window.onerror=t,$(document).off("ajaxError").ajaxError(e)}}function IframeSessionExpirationHandler(){function t(t){"auth:login"===t.originalEvent.data&&(location.href="/logout")}this.init=function(){$(window).on("message",t)}}function readonly(t){t.off(),t.is("select")&&!t.is(":disabled")&&(t.after("<input type='hidden' name='"+t.attr("name")+"' value='"+(null!=t.val()?t.val():"")+"'>"),t.prop("disabled",!0),$.mobile&&t.closest(".ui-select").addClass("readonly")),"checkbox"==t.attr("type")&&t.on("click",function(){return!1}),(t.hasClass("ui-slider-switch")||t.hasClass("ui-slider-input"))&&t.slider("disable"),"radio"==t.attr("type")&&(t.is(":checked")||t.parents("label").hide()),t.hasClass("datepicker-input")&&$(".add-on",t.closest(".date")).unbind(),t.attr("readonly",!0),t.addClass("readonly").parent(".input-append").addClass("readonly")}function formattedNumber(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function parseDate(t){if(!t||!t.trim())return null;var e=t.split(".");return e.length<3?null:new Date(e[2],e[1]-1,e[0],0,0,0,0)}function debounce(t,e){var n;return function(){var a=arguments,i=this;clearTimeout(n),n=setTimeout(function(){t.apply(i,a)},e)}}function escapeHTML(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function normalizeDecimalInPlace(t){return null==t?t:(t=t.replace(/(\s|\u00a0|’)+/g,""),t=t.replace(/(\d)[,-]/,"$1."))}function enableAutofocusOnModal(t){t.on("shown.bs.modal",function(t){$("[autofocus]",t.target).focus()})}function showAjaxDialog(t,e,n){var a=$(e||"#default-dialog");a.empty(),a.load(t,null,function(t,e){"error"!=e&&(a.modal(),n&&n(a))})}function addGaEventTracking(){if(window.ga){var t=$(this);ga("send","event",{eventCategory:t.data("ga-event"),eventAction:t.data("ga-action")})}}function bindCustomHandlers(t){t=t||$("body"),t.find("[data-confirm]").click(function(t){confirm($(this).data("confirm"))||(t.stopImmediatePropagation(),t.preventDefault())}),t.find("[data-ga-event]").click(addGaEventTracking)}function resizeScrollableTableHeaderColumns(){$(".scrollable").each(function(t,e){var n=$(e).find("table"),a=$("thead tr:first",n).children().map(function(){var t=$(this).width(),e=parseInt($(this).css("max-width"));return e?Math.min(t,e):t}).get(),i=$('<table class="scrollable-table-header"/>').addClass(n.attr("class")).append(n.find("thead").detach());$(e).before(i),$("thead tr",i).add($("tbody tr:eq(0)",n)).each(function(){$(this).children().each(function(t){$(this).width(a[t])})}),e.scrollHeight>e.clientHeight&&(i.find("thead tr th:last").css({"padding-right":"20px"}),$(e).css("overflow-y","auto"))})}function resizeScrollableTableHeight(){$(".scrollable").length&&$(window).on("resize",function(){var t=$("#footer").outerHeight(),e=$(".form-actions").outerHeight(),n=$(".scrollable");n.animate({"max-height":Math.max($(window).height()-n.offset().top-t-e,200)},100,"linear")}).trigger("resize")}function isAttributeDefined(t,e){return void 0!==t.attr(e)&&!1!==t.attr(e)}function copyAttrIfDestinationNotSet(t,e,n){isAttributeDefined(t,e)&&!isAttributeDefined(t,n)&&t.attr(n,t.attr(e))}function convertNumberInputs(t){var e=$("input.amount, input[type=number]",$(t||document));try{var n=$("html").is(".tablet")?"tel":"text";e.each(function(t,e){e=$(e);var a=e.hasClass("amount")?2:0,i=e.attr("step");i&&i.indexOf(".")>=0&&(a=i.length-i.indexOf(".")-1);var o="[\\d  ’]+([,.-][\\d  ]{1,"+a+"})?";0==a&&(o="[\\d  ’]+"),e.attr("type",n).data("pattern",o),copyAttrIfDestinationNotSet(e,"min","data-min"),copyAttrIfDestinationNotSet(e,"max","data-max")})}catch(t){}e.on("change",function(){this.value=normalizeDecimalInPlace(this.value)})}function toggleAccountAliasEditor(t){$("#account-"+t).find(".alias, .table-action-link, .account-alias-edit-form").toggleClass("hidden").find("input[type=text]").focus()}function enableAjaxResponseEnhancement(){var t=$.fn.html;$.fn.html=function(){var e=t.apply(this,arguments);return initTextareaCharacterCounter(this),enableHtml5Support(this),convertNumberInputs(this),bindCustomHandlers(this),enableAutofocusOnModal(this),window.validator&&validator.replaceNativeValidation(this),e}}function UTCDate(){return new Date(Date.UTC.apply(Date,arguments))}function UTCToday(){var t=new Date;return UTCDate(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())}function parseUrlParams(t){for(var e={},n=t.replace(/(^.*?\?)/,"").split("&"),a=0;a<n.length;a++){var i=n[a].split("=");e[i[0]]=decodeURIComponent(i[1])}return e}function breakLines(t,e,n){for(var a=0,i="",o=0;o<t.length;o++){var r=t.charAt(o);a<=e||!/\s/.test(r)?(i+=r,a++):(i+=n,a=0)}return i}function prepareMultilineSelectPicker(t){t.find("option").each(function(){var t=$(this),e=t.text();t.text(t.val()),t.attr("data-subtext",breakLines(e.replace(new RegExp(t.val(),"g"),""),80,"<br>")),t.attr("title",e)}),t.selectpicker({showSubtext:!0,limitHeight:!0})}function preventEnter(t){t.on("keydown",function(t){return 13!==t.which})}function initTextareaCharacterCounter(t){$(".controls textarea[maxlength], .controls textarea[data-max-length]",t).each(function(){var t=$(this),e=t.closest(".controls"),n=e.prepend('<span class="counter"></span>').find(".counter").width(t.outerWidth()),a=t.attr("maxlength")||t.attr("data-max-length");t.on("keyup.counter change.counter",function(){var e=t.val(),i=(e.match(/\n/g)||[]).length,o=e.length+i;n.text(o+"/"+a).toggleClass("limit",o>parseInt(a))}).trigger("keyup")})}function autocomplete(t,e,n){n||(n={});var a=$(t),i=a.autocomplete(e,{dataType:"json",loadingClass:n.loadingClass||"loading",parse:function(t){if(0==t.length&&n.onEmptyResult)t=n.onEmptyResult(a)||t;else{if(t.error&&n.onError)return n.onError(t.error),{};(t.length>0||Object.keys(t).length>0)&&n.onSomeResult&&n.onSomeResult(a,t)}return $.map(t,function(t){return{data:t,value:t.name,result:t.name}})},formatItem:n.formatItem,minChars:n.minChars||3,scroll:!0,scrollHeight:250,matchCase:!0,width:n.width});return window.keepAutocompleteResults&&$(".ac_input").off("blur"),i}function autocompleteBIC(t,e,n,a,i,o){function r(){$(i).hide(),$(a).val("").hide(),$(o).hide()}function s(t,e){$(i).show();var n=$(a);n.val(e.bic),n.trigger("change"),n.show(),$(o).toggle(!!e.isRevoked)}function c(t){return t.name+"<br>"+e+" "+t.bic}n=n||"#bank",a=a||"#bic",i=i||"#bic-label",o=o||"#bank-license-revoked-alert",autocomplete($(n),t,{formatItem:c,onEmptyResult:r}).result(s),$(n).on("keyup",function(){$(this).val()||r()})}function HelpIcons(){var t=this;t.update=function(){$(".help-icon").each(function(){var t=$(this),e=t.closest(".modal").length?"top":t.data("placement")?t.data("placement"):"right",n=t.find(".help-content"),a=n.length?{trigger:"manual",placement:e,container:"body",html:!0,content:n.html().trim()}:{trigger:"manual",placement:e,container:"body",html:!1};t.popover(a),t.on("mouseenter",function(){function e(e){return 0==$(e).closest(n).length&&e!==t[0]}t.addClass("active").popover("show");var n=$(".popover:last").addClass("help-popover");t.add(n).off("mouseleave").on("mouseleave",function(n){e(n.relatedTarget)&&(t.removeClass("active").popover("hide"),t.off("mouseleave"))})})})},t.init=function(){t.update(),$(document).ajaxSuccess(function(e,n){n.getResponseHeader("content-type").indexOf("text/html")>=0&&t.update()})}}function AffixElement(){this.init=function(){var t=$(".affix-enable");t.wrap('<div class="affix-container"></div>').parent().height(t.outerHeight()),t.width(t.width()).affix({parentOffset:!0})}}function StickyTableHeaders(){this.init=function(){$("thead.sticky").closest("table").stickyTableHeaders()}}function LoaderSplash(t){function e(t,e){e.isDefaultPrevented()||$(e.target).attr("target")||$(e.target).hasClass("no-loader")||setTimeout(a.init,i)}function n(){return $(".ui-loader")}var a=this,i=t||1500;a.init=function(){var t=n();return t.find(".with-progress").addClass("hidden"),t.fadeIn(200),a},this.registerEventHandlers=function(){$(document).on("formValidated",e)},this.setProgress=function(t,e){n().find(".with-progress").removeClass("hidden").find(".bar").css("width",t+"%"),e&&n().find(".description").text(e)},this.hide=function(){n().hide()}}function enableHtml5Support(t){navigator.userAgent.indexOf("Trident")>=0&&$(".input-append input",t).on("focus",function(){$(this).closest(".input-append").addClass("focus-within")}).on("blur",function(){$(this).closest(".input-append").removeClass("focus-within")})}function DynamicAttachments(t){function e(){$("input[type=file]",t).each(function(){$(this).val()||n(this)})}function n(e){$(e).closest(".attachment-block").remove(),1==$(".attachment-block",t).length&&$(".attachment-block .delete-attachment",t).hide()}function a(){$("input[type=file]:not(:last)",t).each(function(){n(this)})}function i(){var e=$(".attachment-block:last",t),n=e.find("[name=attachment]");if(n.val()){var a=n.val().replace(/.*(\/|\\)/,"");r(e,a),n.hide()}}var o=this;t=$(t),t.closest("form").on("submit",e);var r=function(t,e){t.find(".filename").text(e),$(".delete-attachment",t).on("click",function(){n(this)})},s='<a class="delete-attachment"><i class="icon-remove" style="margin-right: 5px;" title="'+i18n("Delete")+'"></i></a><input type="file" name="attachment"><span class="filename"></span>';return $.mobile&&(s='<div class="ui-input-text ui-file-input"><input type="text" placeholder="'+i18n("Attachment")+'" readonly><input type="file" name="attachment"></div>',r=function(t,e){t.find("input[type=text]").val("× "+e).on("click",function(){n(this)})}),o.toggleAttachmentsUpload=function(e){e?t.show():(a(),t.hide())},o.addAttachmentInput=function(){var e=!1,n=$("[name=attachment]",t);if(n.each(function(){this.value||(e=!0)}),!e){i();var a=$('<div class="attachment-block">'+s+"</div>");$("[name=attachment]",a).on("change",o.addAttachmentInput);var r=$(".controls",t);r.length||(r=t),0==n.length?r.prepend(a):r.append(a),$(".delete-attachment",t).show().last().hide()}},o}function ExternalLinksOpener(t){var e=this;this.openInNewWindow=function(t){var e=window.open();e.opener=null,e.location=t,e.focus()},this.init=function(){$(document).on("click","a.direct-external-link",function(t){t.preventDefault();var n=$(this);e.openInNewWindow(n.attr("href"))}),$(document).on("click","a.warning-external-link",function(n){n.preventDefault();var a=$(this);$.confirm({title:a.text(),text:t.textLeavingSiteWarning,confirmButton:t.textForward,cancelButton:t.textCancel,confirm:function(){e.openInNewWindow(a.attr("href"))}})})}}function DoubleClickPreventer(){function t(t){var e=$(t.target);if(!e.hasClass("no-disable-on-submit")){var n=$("button:not(.close):not(.dropdown-toggle), input[type=submit]",e);n.attr("name")||n.prop("disabled",!0).addClass("disabled-on-submit"),n.parent().is(".btn-group")&&n.parent().find("button").prop("disabled",!0)}}function e(){$(".disabled-on-submit").prop("disabled",!1).removeClass("disabled-on-submit")}this.init=function(){$(document).on("submit",t).ajaxComplete(e)}}function AjaxModal(){function t(t){var e=$(t.target);return e.hasClass("ajax-modal")||(e=e.closest("a")),showAjaxDialog(e.attr("href"),e.data("container")),!1}this.init=function(){$("a.ajax-modal").on("click",t)}}function ConfirmDialog(t){function e(e){$(e).on("click","a.post",function(a){function i(){var n=$('<form method="POST" class="hidden">').attr("action",r.attr("href"));n.append($('<input type="hidden" name="authenticityToken">').val(t)),n.appendTo(e),n.submit()}function o(){$(".confirmation-modal .btn").prop("disabled",!0),i()}var r=$(this),s=r.data("post-confirmation");if(s)if(n.isMobile())app.confirm(s,i,$.noop);else{var c={text:s,confirm:o},l=r.data("post-confirmation-title");l&&(c.title=l),$(".modal:visible").modal("hide"),$.confirm(c)}else r.prop("disabled",!0),i();return!1})}var n=this;this.isMobile=function(){return window.app&&app.confirm},this.init=function(t){t=t||document.body,e(t),n.isMobile()||($.confirm.options.title=i18n("confirmDialog.areYouSure?"),$.confirm.options.confirmButton=i18n("confirmDialog.yes"),$.confirm.options.cancelButton=i18n("confirmDialog.no"))}}function SmartMask(t){function e(e){return t.customFormat?e.replace(/[^0-9а-яА-ЯA-Za-z]/g,""):e.match(/^[+0-9]/)?e.replace(/[^0-9]/g,""):e}function n(t){return s[t]||t}function a(t){return-1!=c.indexOf(t)}function i(t,e){for(var i="",o=0,r=0;o<e.length&&r<t.length;o++){var s=e[o];if("9"==s||"Я"==s||"*"==s||"!"==s){var c=t[r++].toUpperCase();if("!"!=s&&"Я"!=s||(c=n(c)),"9"==s&&(c<"0"||c>"9"))break;if("Я"==s&&(c<"А"||c>"Я"))break;if("!"==s&&!a(c)&&(c<"0"||c>"9"))break;if("*"==s&&(c<"А"||c>"Я")&&(c<"0"||c>"9")&&(c<"A"||c>"Z"))break;i+=c}else i+=s}return i}function o(e){return t.customFormat==SmartMask.PHONE?(e.match(/^8/)&&(e="7"+e.substring(1)),e.match(/^[^7]/)&&(e="7"+e)):t.customFormat||(e.match(/^89/)&&(e="7"+e.substring(1)),e.match(/^(9[0-5]|999)/)&&(e="7"+e)),e}var r=this,s={E:"Е",T:"Т",O:"О",P:"Р",A:"А",H:"Н",K:"К",X:"Х",C:"С",B:"В",M:"М",Y:"У"},c=Object.keys(s).map(function(t){return s[t]});"string"==typeof t&&(t={customFormat:t}),t=$.extend({masks:[SmartMask.MASKS.phone,SmartMask.MASKS.account,SmartMask.MASKS.card]},t),t.customFormat&&(t.masks=[{detect:"",format:t.customFormat}]),r.format=function(n){for(var a=o(e(n)),r=0;r<t.masks.length;r++){var s=t.masks[r];if(a.match(s.detect)){var c=i(a,s.format);return{value:c,cleanValue:e(c),detectedFormat:s.format}}}return{value:n,cleanValue:n,detectedFormat:null}}}function SmartInputMask(t,e){function n(){return t.selectionStart==t.value.length}function a(){var e=i.detectedFormat,n=i.value;e&&n.length<e.length&&"-+./() ".includes(e[n.length])&&(i.value+=e[n.length],t.value=i.value)}var i=this,o=new SmartMask(e);i.value="",i.cleanValue="",i.detectedFormat=null,"string"==typeof t&&(t=$(t)),t.length?t=t[0]:0===t.length&&(t=null),t&&"hidden"==t.type&&(t=null),i.format=function(){var e=o.format(t.value);i.value=e.value,i.cleanValue=e.cleanValue,i.detectedFormat=e.detectedFormat,t.value=e.value},i.init=function(){return t&&(i.format(),$(t).on("keyup paste input",function(t){n()&&(i.format(),8!=t.keyCode&&a())}).on("blur",function(){i.format()})),i},i.setValue=function(e){return t.value=e,i.format(),i}}function Offers(t,e){function n(n,a,i){if(e)return $.post("/bspboffers/setcrmbannerofferrequest",{bannerEventName:n,timeMethodName:a,hintId:i,authenticityToken:t})}function a(e){var n=$(e.target).closest(".offer"),a=o(n);$.post(e.target.href,{authenticityToken:t}),c.notifyDecline(a);var r=$(".offer:not(:visible):first");return n.animateTo($("#offers-button"),function(){n.remove(),$(".offer").length||$("#show-all-offers").hide(),i(r)}),!1}function i(t){t.length&&c.notifyShown(o(t))}function o(t){return t.attr("id").replace("offer-","")}function r(t){if(s(t))return!0;var n=$(this).find(".offer-action"),a=n.attr("href");return!a||(!e||(c.notifyClick(o($(this))).done(function(){var t=n.attr("target");t?window.open(a,t):c.openUrl(a)}),!1))}function s(t){var e=$(t.target).closest("a");return e.is("a")&&e.closest(".offer-text").length>0}var c=this;c.notifyClick=function(t){return n("SetPressedMoreTime","pressedMore",t)},c.notifyDecline=function(t){return n("SetPressedNotNowTime","pressedNotNow",t)},c.notifyShown=function(t){return n("SetBannerDisplayedTime","bannerDisplayed",t)},c.openUrl=function(t){window.location.assign(t)},c.init=function(){$(".offer:visible").each(function(t,e){var n=$(e).attr("id").replace("offer-","");c.notifyShown(n)}),$(".offer .decline").on("click",a),$(".offer").on("click",r)}}function TableSorter(){var t=this;t.init=function(){$.tablesorter.addParser({id:"amount",is:function(e){return t.isAmount(e)},format:function(e){var n=t.formatAmount(e);return isNaN(n)?-Number.MIN_VALUE:n},type:"numeric"}),$.tablesorter.addParser({id:"date",is:function(t){return t.match(/[0-9]{2}\.[0-9]{2}\.[0-9]{4}/)},format:function(t){return t=t.trim().substring(0,10),t.replace(/([0-9]{2})\.([0-9]{2})\.([0-9]{4}).*/g,"$3$2$1")},type:"numeric"}),$("table.sortable").tablesorter()},t.isAmount=function(t){return t.match(/^\s*-?[0-9\u00A0.]+\s*[A-Z]{3}\s*$/)},t.formatAmount=function(t){return parseFloat(t.replace(/[^\-0-9.]/g,""))}}function initPage(t,e){$.mobile?$(document).one("pageinit",function(n){var a=n.target;window.boot.then(function(){t(a)}),e&&$(a).one("pageremove",function(){e(a)})}):$(function(){t(document.body)})}function PhoneNumberField(t){function e(){var t=k.closest(".ui-page"),e=$("#phone-search-results",t);b={page:t,phoneSearch:$("#phone-search",t),phoneSearchInput:$("#phone-search-input",t),phoneSearchResults:e,phoneSearchResultsList:$("ul",e)}}function n(){g=new SmartInputMask(b.phoneSearchInput,{masks:[SmartMask.MASKS.phone]}).init()}function a(t){return t?t.replace(/[^0-9А-ЯA-Z]/gi,""):""}function i(t){var e,n=a(b.phoneSearchInput.val()).toUpperCase();t.contacts.forEach(function(t){var a=!n||t.hash.indexOf(n)>=0;t.li.css("display",a?"":"none").removeClass("last-visible"),a&&(e=t.li)});var i=t.enteredItem;g.detectedFormat!==SmartMask.PHONE||e?i.hide():($(".phone",i).text(g.value),e=i.show()),e&&e.addClass("last-visible")}function o(t){return $('<li><a class="ui-btn"><span class="name">'+t.name+'</span><span class="phone">'+t.phone+"</span></a></li>")}function r(t){var e=[],n=new SmartMask({customFormat:SmartMask.PHONE});return t.forEach(function(t){e.push(s(t,n))}),e}function s(t,e){var n=t.phone,i=a(t.phone);if(t.phone.length>10){var r=e.format(t.phone);n=r.value,i=r.cleanValue}var s=o({name:t.name,phone:n});return s.on("vclick",function(){return c(t),!1}),{li:s,hash:a(t.name).toUpperCase()+i}}function c(t){v.setValue(t.phone),S({phone:v.cleanValue,name:t.name}),d()}function l(){return o({name:C.enteredNumber}).on("vclick",function(){return v.setValue(b.phoneSearchInput.val()),S({phone:v.cleanValue}),d(),!1})}function u(t){var e=r(t),n=$(document.createDocumentFragment());e.forEach(function(t){n.append(t.li)});var a=l();n.append(a);var o={contacts:e,enteredItem:a};return i(o),b.phoneSearchResultsList.append(n),o}function d(){history.back()}function f(){return b.phoneSearch.hide(),b.phoneSearchInput.blur(),!1}function p(){history.pushState({},"Enter or search phone"),$(window).one("popstate",f),b.phoneSearch.show(),b.phoneSearchInput.focus()}function m(t){k.prop("readonly",!0),k.on("vclick",function(){return p(),!1}),b.phoneSearchInput.on("keyup paste input",function(){i(t)}),b.page.on("pagebeforehide",function(){$(window).off("popstate",f)}),b.phoneSearchInput.on("keypress",function(t){var e=b.phoneSearchResultsList.find("li:visible");13===t.which&&1===e.length&&e.click()}),k.is(":focus")&&p()}function h(t){if(t.length){n();m(u(t))}else k.on("blur keyup",function(){S({phone:y.phone,name:void 0})})}var v,g,b,y=this,w=t.phonesRepository,k=$(t.input),S=t.onChange,C=t.messages;Object.defineProperties(y,{phone:{get:function(){return v.cleanValue}},hasPhone:{get:function(){return!!y.phone}}}),this.init=function(){return e(),v=new SmartInputMask(k,SmartMask.PHONE).init(),w.all(h),this}}function CurrencySymbolProvider(){function t(t){return n.find(t)||{}}var e=this,n=[{code:"RUB",symbol:"₽"},{code:"EUR",symbol:"€"},{code:"USD",symbol:"$"},{code:"GBP",symbol:"£"}];e.symbol=function(e){return t(function(t){return t.code===e}).symbol||e},e.code=function(e){return t(function(t){return t.symbol===e}).code||e}}function SelectionBasedPopover(t,e,n){function a(){return $(e).filter(function(e,n){return $(n).data("popover-content-ref")==$(t).val()}).html()}this.init=function(){$(n).popover({placement:"right",trigger:"manual",content:a,html:!0}).on("click",function(){return $(n).popover("toggle")}),$(document).on("click",function(t){$(t.target).closest(".help-inline").length||$(n).popover("hide")})}}function CurrencyExchangeForm(t){var e=this;e.init=function(n){function a(t){return t.closest(".control-group")}function i(t,e){e&&t.val(""),t.prop("disabled",e).closest(".input-append").toggleClass("readonly",e),a(t).toggleClass("disabled",e)}function o(){i(d,!!f.val())}function r(){i(f,!!d.val())}function s(){var t=l.find("option:selected").attr("currency");$(".from-currency").text(t)}function c(){$("#to-currency").text($("option:selected",this).attr("currency"))}var l=$("#acc1",n),u=$("#acc2",n),d=$("#to-amount",n),f=$("#from-amount",n);t.selectedBeneficiary||function(){var t=l.find("option:selected").attr("currency-code"),e=u.find('option:not([value=""]):not([currency-code='+t+"])").attr("value");u.val(e).trigger("change")}(),l.on("change",e.composes(r,s,o)).trigger("change"),u.on("change",e.composes(c)).trigger("change"),d.on("keyup change",e.composes(r)),d.val()&&d.trigger("change"),f.on("keyup change",e.composes(o)),f.val()&&f.trigger("change")},e.composes=function(){var t=arguments;return function(){for(var e=0;e<t.length;e++)t[e].apply(this,arguments)}}}function Confirmation(t,e){function n(t){(l?l[0].contentWindow:window).postMessage(t,"*")}function a(t){var e=$('<form action="'+r("/auth/confirm")+'" method="post"></form>');return Object.keys(t).forEach(function(n){$('<input type="hidden" name="'+n+'">').attr("value",t[n]).appendTo(e)}),e}function i(t){$.mobile||(l=$('<iframe id="confirmation-frame"></iframe>'),c.html(l));var e=o(t);if(l){var n=l[0].contentDocument;n.body||n.write("<body></body>"),a(e).appendTo(n.body).submit()}else $.ajax({url:r("/auth/confirm"),method:"POST",data:e}).then(function(t){c.html(t).enhanceWithin(),$("html, body").animate({scrollTop:c.offset().top},300)})}function o(n){var a={access_token:n,redirect_uri:r("/auth/confirm/callback")};return e.customerId&&(a.customer_id=e.customerId),$.mobile&&(a.mobile=!0),e.data&&(a.data=e.data),e.type&&(a.type=e.type),e.align?a.align=e.align:t.closest(".modal").length&&(a.align="right"),a}function r(t){var e=$.mobile?app.url:"";return e||(e=s.location.href.replace(/(https?:\/\/[^\/]+).*/,"$1")),e+t}var s=this;if(s.location=window.location,t=$(t||"form"),1!=t.length)throw new Error("Form should be provided");if(t.data("confirmation"))throw new Error("Another confirmation already used for this form");t.data("confirmation",this),e=e||{};var c=t.find(".confirmation");if(!c.length)throw new Error("Could not find confirmation container");var l;s.ready=$.Deferred(),s.enable=function(){n("enable")},s.disable=function(){n("disable")},s.handleMessage=function(n){var a=n.originalEvent.data;if("string"==typeof a)if(a.startsWith("confirm:error:"))alert(a.substring("confirm:error:".length)),window.app&&app.reset?app.reset():s.location.href="/logout";else if(a.startsWith("confirm:success:")){s.stopListeningToMessages();var i=a.substring("confirm:success:".length);e.gaEvent&&ga("send","event",e.gaEvent,e.gaAction?e.gaAction:"confirm"),t.append('<input type="hidden" name="confirmationKey" value="'+i+'">'),s.submit()}else"confirm:ready"==a?s.ready.resolve():"confirm:change"==a&&e.onChange&&e.onChange()},s.changeAllInputsToReadonly=function(){t.find(":input").each(function(){var t=$(this);t.hasClass("immune")||t.is(":hidden")||readonly(t.blur().off())}),$.mobile&&t.find(".swiper-container-horizontal").each(function(t,e){$(e).addClass("swiper-no-swiping")})},s.listenToMessages=function(){$(window).on("message",s.handleMessage)},s.stopListeningToMessages=function(){$(window).off("message",s.handleMessage)},s.showConfirmationFormWithValidAccessToken=function(){$.get("/access-token").done(function(t){i(t.access_token)})},s.confirmationFrame=function(){return $("html",l[0].contentDocument)},s.submit=function(){t.off("submit").submit()}}function FormConfirmation(t,e,n){t=$(t),this.start=function(){$.post(e,t.serialize(),function(e){t.append('<input type="hidden" name="cacheKey" value="'+e.cacheKey+'">'),n=n||{},n.data=e.signingData,new Confirmation(t,n).start()})}}function PreviewConfirmation(t){this.options=t}function PhonesRepository(t){function e(t,e){var n=e.reduce(function(t,e){return t[e.phone]||(t[e.phone]=[]),t[e.phone].push(e),t},{}),a=[];t.forEach(function(t){var e=n[t.phone];e?a=a.concat(e):a.push(t)});var i=e.filter(function(t){return-1===a.indexOf(t)});return a.concat(i)}function n(t){return r.format(t.phone).cleanValue}function a(t){var e=[];return t.forEach(function(t){t.phone&&(t.phone=n(t),e.push(t))}),e}function i(t){var e={};return t.reduce(function(t,n){var a=n.name+n.phone;return e[a]||(e[a]=!0,t.push(n)),t},[])}var o=this,r=new SmartMask({masks:[SmartMask.MASKS.phone]});o.all=function(n){t=a(t),o.hasAccessToDeviceContacts()?(new PhoneContacts).all(function(o){o=a(o),o=i(o),n(e(t,o))},function(){n(t)}):n(t)},o.hasAccessToDeviceContacts=function(){return!!window.PhoneContacts}}function UnifiedPhonePayments(t){function e(t){var e=$("#unified-phone-payment-form",t),n=$("#phone-operator-selection",t),a=$("#suggest-subscription-fields",e);d.elements={page:$(t),alerts:$("#alerts-container",t),form:e,vendorId:$('input[name="payment.vendorId"]',e),serviceId:$('input[name="payment.serviceId"]',e),amount:$('input[name="payment.amount"]',e),comment:$('[name="payment.comment"]',e),showSuggestSubscription:$("#show-suggest-subscription",e),suggestSubscription:$("#suggest-subscription",e),suggestSubscriptionFields:a,suggestSubscriptionFieldInputs:$(":input",a),suggestSubscriptionFieldThresholds:$("select.service-thresholds",a),autoSelectedMessage:$("#auto-selected-message",t),phone:$('[name="phoneNumber"]',e),operatorSelection:n,operatorButtons:$("a[data-vendor]",n)}}function n(){return $.mobile?a():i()}function a(){return d.formAjaxSubmitHandler||(d.formAjaxSubmitHandler=(new FormAjaxSubmitHandler).init(d.page)),$.post("/vendors/unified-phone-payment/submit",d.elements.form.serialize()).then(d.formAjaxSubmitHandler.handle).then(function(t){d.elements.operatorButtons.off("click"),d.elements.form.append($('<input type="hidden" name="paymentId">').val(t.paymentId)),t.signingData?(new Confirmation(d.elements.form,{data:t.signingData}).start(),t.askForTrustedFavoriteBeneficiary&&u(t)):d.elements.form.off("submit").submit()}),!1}function i(){return!!validator.validate(d.elements.form)&&(d.elements.vendorId.val()?void d.elements.alerts.html(""):(d.elements.alerts.html('<div class="alert alert-error">'+t.messages.selectManually+"</div>"),!1))}function o(e,n){function a(t,e){return!(!t||!e)&&(t==e||t.vendorId==e.vendorId&&t.serviceId==e.serviceId)}d.elements.operatorSelection.trigger("change"),e.error?(d.elements.vendorId.val(""),d.elements.serviceId.val(""),d.elements.amount.addClass("required").data("min",0)):(d.elements.vendorId.val(e.vendorId),d.elements.serviceId.val(e.serviceId),d.elements.amount.addClass("required").data("min",e.minAmount)),d.elements.operatorButtons.each(function(){$(this).find("img").toggleClass("selected",a(e,$(this).data("vendor")))}),d.elements.autoSelectedMessage.toggle(!e.error&&!n),-1!==t.serviceIdsForSubscription.indexOf(e.serviceId)?(r(d.elements.showSuggestSubscription.is(":checked"),e.serviceId,!1),d.elements.suggestSubscription.slideDown()):(d.elements.suggestSubscription.slideUp(),r(!1,e.serviceId,!1)),d.elements.operatorSelection.show(),t.vendorServiceFee.calculate()}function r(t,e,n){d.elements.suggestSubscriptionFieldInputs.prop("disabled",!t),t?(d.elements.suggestSubscriptionFieldThresholds.hide().prop("disabled",!0).filter("#service-"+e).prop("disabled",!1).show(),n&&d.elements.suggestSubscriptionFields.slideDown()):n&&d.elements.suggestSubscriptionFields.slideUp()}function s(){var e=new PhoneNumberField({phonesRepository:t.phonesRepository,input:d.elements.phone,onChange:function(t){d.elements.phone.trigger("change"),c(t.phone),d.elements.comment.val(t.name)},messages:t.messages}).init();t.selectedService||c(e.phone),e.hasPhone&&d.elements.amount.focus()}function c(t){if(t.length>3){var e=t.substr(1,3);f!==e?(f=e,$.get("/phone-operator/by-number/"+t).then(function(t){o(t,!1)})):d.elements.operatorSelection.show()}else f="",o({error:!0},!0),d.elements.operatorSelection.hide()}function l(){d.elements.operatorButtons.on("click",function(){o($(this).data("vendor"),!0)})}function u(t){d.elements.form.find(".form-items").append($('<li class="control-group"><label class="checkbox" for="makeTrusted"><input type="checkbox" checked name="makeTrusted" id="makeTrusted" class="immune">'+t.trustedFavoriteConfirmationLabel+"</label></li>"))}var d=this;t=$.extend(!0,{messages:{enteredNumber:"",selectManually:""},selectedService:"",serviceIdsForSubscription:[],vendorServiceFee:void 0,phonesRepository:void 0,accessToken:""},t);var f;d.hasErrors=function(){return!!d.elements.form.find(".error").length||!!d.elements.page.find(".alert-error").text().length},d.init=function(a){d.page=a,e(a),s(),l(),d.elements.form.on("submit",n),d.elements.amount.addClass("required").data("min","1"),t.serviceIdsForSubscription&&d.elements.showSuggestSubscription.on("change",function(){r($(this).is(":checked"),d.elements.serviceId.val(),!0)}).trigger("change"),d.elements.operatorButtons.each(function(){$(this).data("vendor")&&t.selectedService==$(this).data("vendor").serviceId&&$(this).click()})}}function FormAjaxSubmitHandler(){this.init=function(t){function e(t){n(),r(t.notifications),a(t.errors)}function n(){l.empty(),c($(".control-group",u))}function a(t){t&&t.forEach(function(t){var e=o(t);e.length?i(e,t):s(t.level,t.message)})}function i(t,e){t.addClass("error"),$.mobile?t.append('<div class="error tooltip">'+e.message+"</div>"):t.find(".controls").append('<span class="help-inline error-message">'+e.message+"</span>")}function o(t){var e=$('[name="'+t.field+'"]:visible',u).closest(".control-group");return e.length||(e=$('.control-group[data-name="'+t.field+'"]:visible',u)),e}function r(t){t&&t.forEach(function(t){return s(t.level,t.message)})}function s(t,e){l.append('<div><div class="alert alert-'+t+'">'+e+"</div></div>")}function c(t){t.removeClass("error hasError").find(".error-message,.error").remove()}var l=$("#alerts-container",t),u=$("form",t);return this.handle=function(t){var n=$.Deferred();return t.redirectUrl?(app.openUrl(t.redirectUrl,{reloadPage:!0}),n.promise()):(e(t),t.errors?n.promise():n.resolve(t).promise())},u.on("change",":input",function(t){var e=$(t.target).closest(".control-group");e.length&&c(e)}),u.on("keyup",":input",function(t){if(13!=t.which){var e=$(t.target).closest(".control-group");e.length&&c(e)}}),u.on("change",".control-group",function(t){c($(t.target))}),this}}function FieldVat(t){function e(t){return Number(t.trim().replace(",",".").replace(/[^\d.]/g,""))}function n(){r(),s()&&c(),l(),a()}function a(){if(f(b),k||!s())return void o();k=i(),b.val(k.toFixed(2)).trigger("change"),o()}function i(){var t=x.val(),e=parseInt(C.val());return"PLUS"===t?S*e/100:"INCLUDING"===t?S-S/(1+e/100):0}function o(){var t=S;"PLUS"===x.val()&&(t=S+k),w.val(t.toFixed(2))}function r(){v.hide(),g.prop("disabled",!0),b.prop("disabled",!0).closest(".input-append").hide()}function s(){return["10","20"].indexOf(C.val())>=0}function c(){v.show(),g.prop("disabled",!1),x.closest(".radio-group-item").find(".input-append").show().find('[name="'+A+'.vatAmount"]').prop("disabled",!1)}function l(){var t=x.filter(":visible").val();d(y,I.paymentAmountIncreasedByVat,"PLUS"===t)}function u(t){d(t,I.vatAmountChangedManually,k!==i())}function d(t,e,n){f(t),n&&p(t).append('<span class="info-message">'+e+"</span>")}
function f(t){$.each(t,function(t,e){$(".info-message",p($(e))).remove()})}function p(t){return t.closest(".input-append").parent()}function m(){var t=$('[name="initial-vat-rate"]').val();T.indexOf(t)>-1&&h.filter('[value=""]').click()}var h,v,g,b,y,w,k,S,C,x,A=t.objectName,I=t.messages,T=["0","18"];this.init=function(){function t(t){S=e($(t.target).val()),k=null,a()}v=$("#vat-accrual"),h=$('[name="'+A+'.vatRate"]'),g=$("[name=accrual]",v),b=$('[name="'+A+'.vatAmount"]',v),y=$('[name="'+A+'.amount"]').attr("name",""),w=$('<input type="hidden" name="'+A+'.amount"/>'),y.after(w),C=h.on("change",function(t){C=$(t.target),k=null,n()}).filter(":checked"),x=g.on("change",function(t){x=$(t.target),k=null,n()}).filter(":checked"),y.on("keyup",t).on("paste",function(e){setTimeout(function(){t(e)},0)}),S=e(y.val()),k=e(b.on("keyup",function(t){var n=$(t.target);n.is(":disabled")||(k=e(n.val()),u(n),o())}).eq(0).val()),m(),n()}}function DetailsFieldValidator(t){function e(){return a()?o():r()}function n(){var t=$('[name="'+u+'.details"]'),e=t.data("max-length");return t.val().length<=e?null:l["validation.maxLengthExceeded"]}function a(){return""===$('[name="'+u+'.vatRate"]').filter(":checked").val()}function i(){if(!t.defaultPaymentPriority)return!1;var e=$('[name="payment.priority"]');return 0!==e.length&&e.val()!=t.defaultPaymentPriority}function o(){return s()?null:i()?null:c.detailsContainVat()?null:l["validation.missingVAT"]}function r(){return c.detailsContainVat()?l["validation.excessVAT"]:null}function s(){return"tax"===t.objectType}var c=this,l=t.messages,u=t.objectName;c.validateDetails=function(){return n()||e()},c.detailsContainVat=function(){return new RegExp("(^|\\s|[.,;!?:\"'`%()-])(НДС|VAT)([.,;!?:\"'`%()-]|\\d|\\s|$)","i").test($('[name="'+u+'.details"]').val())}}function DetailsField(t){function e(){if(p="","10"===c||"20"===c){var t=Number(s.replace(",",".").replace(/[^\d.]/g,"")).toFixed(2);p=v["vat.details.INCLUDING"]+" "+c+"% ("+t+" "+u+")"}else"-1"===c&&(p=v["vat.details.NOT_TAXED"]);l.text(p).toggle(!!p),n()}function n(){var t=a();m.text(t+"/"+b).toggleClass("limit",t>parseInt(b)),d.data("max-length",i())}function a(){return p.length?f.length+h+p.length:f.length}function i(){return p.length?b-p.length-h:b}function o(){"0"!=$('[name="initial-vat-rate"]').val()||y.detailsContainVat()||d.val(f=f+" "+v["vat.details.INCLUDING"]+" 0%")}function r(t){u=w.code(t.target.innerText),e()}var s,c,l,u,d,f,p,m,h="\r\n".length,v=t.messages,g=t.objectName,b=t.maxLength,y=t.fieldValidator,w=t.currencySymbolProvider;this.init=function(){l=$("#vat-details"),d=$('[name="'+g+'.details"]'),m=d.closest(".control-group").find(".counter");var t=$("#vat-accrual #currency");u=w.code(t.eq(0).text());var a=$('[name="'+g+'.vatRate"]');d.off(".counter"),f=d.on("keyup change",function(t){f=$(t.target).val(),n()}).val(),a.length&&(c=a.on("change",function(t){c=t.target.value,e()}).filter(":checked").val(),s=$('[name="'+g+'.vatAmount"]').on("keyup change",function(t){var n=$(t.target);n.is(":disabled")||(s=n.val(),e())}).filter(":enabled").val(),t.on("DOMSubtreeModified",r),o(),d.data("validate-custom",y.validateDetails)),e()}}function UserAlerts(t){function e(t){u.notificationCountBadge.text(t),u.notificationCountBadge.toggle(t>0)}function n(){u.notificationButton.addClass("shake")}function a(){return"/overview"==(t.location||window.location).pathname}function i(){u.notificationButton.popover({content:t.textNoAlerts,placement:"bottom"}),u.notificationButton.popover("show"),setTimeout(function(){u.notificationButton.popover("hide")},2e3)}function o(t){var e=$("#notifications-button").offset(),n=$("#notifications-button").height(),a=t.width(),i=e.left-.9*a+5+"px",o=e.top+n+15+"px";t.css({left:i,top:o,"margin-left":"0"}),t.find(".arrow-up").show()}function r(){u.alertCount?showAjaxDialog("/alerts?openedManually=true","#alerts-modal-container",o):i()}function s(){return document.cookie.indexOf("alertsMuted"+t.user+"=true")>=0}function c(){return"; expires="+u.expirationTime().toGMTString()}function l(e){var n=c();document.cookie="alertsMuted"+t.user+"="+e+n}var u=this;u.notificationCountBadge=$("#notifications-count"),u.notificationButton=$("#notifications-button"),u.alertCount=t.unreadAlerts,u.refreshAlerts=function(){$.get("/alerts/status",function(t){u.alertCount=t.newCount,e(t.newCount),0!=t.newCount&&(t.newCount>t.lastCount&&n(),a()&&!s()&&showAjaxDialog("/alerts","#alerts-modal-container"))})},u.expirationTime=function(){var t=new Date;return t.setDate((new Date).getDate()+1),t.setHours(0,0,0,0),t},u.mute=function(){l(!0)},u.init=function(){u.notificationButton.on("click",r),$(document).on("change","#muteAlerts",function(t){l(t.target.checked)}),t.unreadAlerts&&e(t.unreadAlerts),setTimeout(u.refreshAlerts,0)}}function CountBadges(t){function e(t,e){t.find(".badge").remove(),e>0&&t.append('<span class="badge">'+e+"</span>")}var n=this;return n.update=function(){$.get("/overview/counts",function(n){e($(".ui-navbar .subscriptions",t),n.invoices),e($(".messages",t),n.messages),e($(".offers",t),n.offers)})},n.resetOffersCounter=function(){e($(".offers",t),0)},n}(new GlobalErrorHandler).init(),String.prototype.startsWith||(String.prototype.startsWith=function(t){return 0==this.indexOf(t)});var m$=$;$(function(){function t(){var t=$(this).val(),e=$(this).siblings(".composite-customer-accounts"),n=$(this).siblings(".account-select"),a=n.val();n.find("option").remove(),e.find(".customer-"+t).clone().appendTo(n);var i=n.val();n.val(i),a!=i&&n.trigger("change"),$(this).siblings(".selectpicker").selectpicker("refresh")}navigator.userAgent.indexOf("MSIE")>=0&&$("html").addClass("ie"),enableAjaxResponseEnhancement(),$(document).ajaxSuccess(function(t,e,n,a){!n.noReloadOnFullResponse&&a&&a.indexOf&&0==a.indexOf("<!DOCTYPE")&&location.reload()}),$(document).ajaxStart(function(){$("body").addClass("in-progress")}),$(document).ajaxStop(function(){$("body").removeClass("in-progress")}),$(".locales .btn-toggle").on("click",function(t){setTimeout(function(){location.href="/locale/"+($(t.target).hasClass("active")?"ru":"en")},300)}),$(".modal").on("show",function(){$("embed, object").css("visibility","hidden")}),$(".modal").on("hidden",function(){$("embed, object").css("visibility","visible")}),$("input.clearable").wrap('<span class="clearicon"></span>').after($('<span class="clickable"/>').click(function(){$(this).prev("input").val("").focus().keyup()})),initTextareaCharacterCounter(),(new TableSorter).init(),window.lastShiftClickableIndex=0,$(".shift-clickable").on("click",function(t){var e=$(".shift-clickable").index(t.target);if(t.shiftKey){var n=!!$(t.target).prop("checked"),a=Math.min(e,window.lastShiftClickableIndex),i=Math.max(e,window.lastShiftClickableIndex);$(".shift-clickable").each(function(t,e){t>=a&&t<=i&&$(e).prop("checked",n)})}window.lastShiftClickableIndex=e}),convertNumberInputs(),bindCustomHandlers(),$("body").on("touchstart.dropdown",".dropdown-menu",function(t){t.stopPropagation()}),$(".modal").attr("tabindex","-1"),resizeScrollableTableHeaderColumns(),resizeScrollableTableHeight(),$(document).on("submit",".account-alias-edit-form",function(t){var e=$(t.target).find("[name=accountId]").val(),n=this,a=$(n).find("button");return a.prop("disabled",!0),$.post(n.action,$(n).serializeArray(),function(t){$('[data-account-id="'+e+'"], #account-'+e).find(".alias").text(t),a.prop("disabled",!1),toggleAccountAliasEditor(e)}),!1}),$(".navigation-menu .dropdown-toggle").on("touchend",function(){return $(this).dropdown("toggle"),!1}),$(".composite-customer-select").on("change",t).each(t),$(".datepicker-input").each(function(){new SmartInputMask(this,SmartMask.DATE).init()})}),$.fn.animateTo=function(t,e){this.css({position:"absolute",left:this.offset().left,top:this.offset().top,width:this.width(),height:this.height()}).appendTo("body"),this.animate({top:t.offset().top,left:t.offset().left,width:t.width(),height:t.height(),opacity:.2},600,function(){$(this).remove(),e&&e.apply(t)})},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){for(var n=e||0,a=this.length;n<a;n++)if(this[n]===t)return n;return-1});var helpIcons=new HelpIcons;$(function(){helpIcons.init()}),$(function(){(new AffixElement).init()}),$(function(){(new StickyTableHeaders).init()});var validator=window.validator||{validators:{}};validator.validators.els=function(t){if(""!==t){var e=i18n("validation.invalid"),n=/^\d{2}[АВЕКМНОРСТУХ]{2}\d{6}$/;if(!t.match(n))return e;var a=(9*t[1]+8*t.charCodeAt(2)+7*t.charCodeAt(3)+6*t[4]+5*t[5]+4*t[6]+3*t[7]+2*t[8]+1*t[9])%10;return t[0]!=a?e:void 0}};var validator=window.validator||{validators:{}};validator.validators.snils=function(t){var e=i18n("validation.invalid");if(14!=t.length)return e;for(var n=t.replace(/[- ]/g,""),a=0,i=0;i<9;i++){a+=(n[i]-"0")*(9-i)}return(a=a%101%100)!=n.substring(9)&&e};var validator=function(pub){function skipValidation(t){return!!t.is(":disabled")||(t.is(":radio")?t.closest("label"):t).is(":hidden")&&!pub.getBootstrapSelect(t).length}function isInvalidEmail(t){return!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)&&i18n("validation.invalidEmail")}function validatePhone(t){var e=t.replace(/[^\d]/g,"");return!!(e.startsWith("7")&&e.length<11||e.length<10)&&i18n("validation.invalidPhone")}function isInvalidWithCustomFunction(el,dataValidateCustom){var validationFunction="function"==typeof dataValidateCustom?dataValidateCustom:eval(dataValidateCustom);try{return validationFunction.call(pub,el)}catch(t){return console.log(t),t}}function isAfterDate(t,e){var n=parseDate(t),a=parseDate(e);return!n||!a||n.getTime()<a.getTime()}function validateVatin(t){if(!t)return!1;return!!(!/^\d*$/.test(t)||("00"==t.substring(0,2)||(12==t.length?!validateVatinWithLength12(t):10==t.length?!validateVatinWithLength10(t):5!=t.length)))&&i18n("validation.VATIN")}function validateVatinWithLength12(t){for(var e=[7,2,4,10,3,5,9,4,6,8],n=0,a=0;a<10;a++)n+=t.substring(a,a+1)*e[a];if(n%11%10!=t.substring(10,11))return!1;var i=[3,7,2,4,10,3,5,9,4,6,8],o=0;for(a=0;a<11;a++)o+=t.substring(a,a+1)*i[a];return o%11%10==t.substring(11,12)}function validateVatinWithLength10(t){for(var e=[2,4,10,3,5,9,4,6,8],n=0,a=0;a<9;a++)n+=t.substring(a,a+1)*e[a];return n%11%10==t.substring(9,10)}function removeError(t){if(t.removeClass("error").closest(".error").removeClass("error hasError").find(".tooltip.error, .error-message").remove().end().find("select").prev(".error:not(input)").removeClass("error"),t.is(":hidden")&&pub.getBootstrapSelect(t).length){var e=pub.getBootstrapSelect(t);e.removeClass("error"),e.tooltip("destroy")}}return pub.validators=pub.validators||{},pub.validators.vatin=validateVatin,pub.validators.phone=validatePhone,pub.validators.email=isInvalidEmail,pub.placement="right",pub.init=function(){$(document).on("change",".error :input, .error:input",function(){removeError($(this))}),$(document).on("submit",function(t){var e=t.target;if(!pub.validate(e))return t.stopImmediatePropagation(),!1;$(document).trigger("formValidated",t)})},pub.replaceNativeValidation=function(t){$(":input",t).on("invalid",function(){return pub.markInvalid($(this),this.validationMessage),!1})},pub.getBootstrapSelect=function(t){return t.next(".bootstrap-select").find("button")},pub.isValueNotInRange=function(t,e,n){if(""==t)return!1;var a=pub.parseNumber(e),i=pub.parseNumber(n),o=pub.parseNumber(t);return isNaN(o)?i18n("validation.invalid"):null!=a&&o<a?i18n("validation.min").replace("%2$d",formattedNumber(e)):null!=i&&o>i&&i18n("validation.max").replace("%2$d",formattedNumber(n))},pub.isInvalid=function(t){t.tooltip("destroy");var e=t.is("[required], .required");if(e&&t.is(":checkbox"))return!t.is(":checked");if(e&&t.is(":radio"))return 0==t.closest("form").find('[name="'+t.attr("name")+'"]:checked').length;var n=t.val();if(e&&!n)return!0;if(t.data("validate-custom"))return isInvalidWithCustomFunction(t,t.data("validate-custom"));if(e||n){if("integer"==t.data("type")&&!n.match(/^[-+]?\d+$/))return!0;if(t.data("pattern")&&!n.match("^"+t.data("pattern")+"$"))return t.data("pattern-message")||i18n("validation.invalidFormat");if(t.attr("pattern")&&!n.match("^"+t.attr("pattern")+"$"))return t.hasClass("amount")?i18n("validation.amount"):i18n("validation.invalidFormat");if(t.data("min-length")&&n.length<t.data("min-length"))return i18n("validation.minSize").replace("%2$s",t.data("min-length"));if(t.data("max-length")&&n.length>t.data("max-length"))return i18n("validation.maxSize").replace("%2$s",t.data("max-length"));var a=null!=t.data("min")?t.data("min"):t.attr("min"),i=null!=t.data("max")?t.data("max"):t.attr("max");if(null!=a||null!=i)return pub.isValueNotInRange(n,a,i);if(t.is("[type=email]"))return isInvalidEmail(n);var o=pub.validators[t.data("validate")];if(o)return o(n);if(t.data("is-after-date")){var r=$(t.data("is-after-date")).val();return!isAfterDate(r,n)&&i18n("validation.dateAfter").replace("%s",r)}}},pub.isValid=function(t){return!pub.isInvalid(t)},pub.markInvalid=function(t,e){t.is(":hidden")&&pub.getBootstrapSelect(t).length&&(t.addClass("error"),t=pub.getBootstrapSelect(t)),0==t.addClass("error").closest(".control-group").addClass("error").length&&t.closest(".input-append, .input-prepend").addClass("error"),t.tooltip({title:!0===e?i18n("validation.required"):e,placement:pub.placement})},pub.validate=function(t){var e=!0;return($(t).is(":input")?$(t):$(":input",t)).each(function(){var t=$(this);if(t.hasClass("selectpicker")&&(t=t.parent().prev()),!skipValidation(t)){var n=pub.isInvalid(t);n&&(pub.markInvalid(t,n),e=!1)}}),$.mobile||$(".error:input").eq(0).focus(),e},pub.parseNumber=function(t){return void 0===t?NaN:"number"==typeof t?t:parseFloat(normalizeDecimalInPlace(t.toString()))},pub.disableValidation=function(t){t.find(".required").removeClass("required"),t.find("[required]").removeAttr("required"),t.find("[pattern]").removeAttr("pattern"),t.find("[data-pattern]").removeAttr("data-pattern").removeData("pattern"),t.find("[min]").removeAttr("min"),t.find("[data-min]").removeAttr("data-min").removeData("min"),t.find(".error").removeClass("error"),t.find("[max]").removeAttr("max"),t.find("[data-max]").removeAttr("data-max").removeData("max"),t.find("[data-validate-custom]").removeAttr("data-validate-custom").removeData("validate-custom"),t.find(":input").each(function(t,e){$(e).removeData("validate-custom")})},pub.clearElementErrors=function(t){removeError(t)},pub.clearErrors=function(t){removeError($(".error",t))},pub}(validator||{}),loaderSplash;$(function(){loaderSplash=new LoaderSplash,loaderSplash.registerEventHandlers()}),$(function(){enableHtml5Support()}),$(function(){$(".cms-content .show-more").click(function(){var t=$(this).attr("data-id");$("#"+t).slideToggle()})}),SmartMask.MASKS={phone:{detect:/^79/,format:"+9 (999) 999-99-99"},account:{detect:/^(3[12][0-9][0-2]|4[0-5][0-9][01]|40820)/,format:"99999 999 9 9999 9999999"},card:{detect:/^(22|4|5|6)/,format:"9999 9999 9999 9999 999"},internationalPhone:{detect:/^\d+/,format:"+9 999 999 9999 9999"}},SmartMask.PHONE=SmartMask.MASKS.phone.format,SmartMask.ACCOUNT=SmartMask.MASKS.account.format,SmartMask.CARD=SmartMask.MASKS.card.format,SmartMask.DATE="99.99.9999",SmartMask.SNILS="999-999-999 99",Confirmation.prototype.start=function(){return this.changeAllInputsToReadonly(),this.showConfirmationFormWithValidAccessToken(),this.listenToMessages(),this.ready},Confirmation.prototype.stop=function(){this.stopListeningToMessages()},PreviewConfirmation.prototype.init=function(){function t(){return a.length===a.filter(":checked").length}function e(){t()?i.enable():i.disable()}var n=$(this.options.form||"form").last(),a=$(".condition:checkbox",n),i=this.confirmation=new Confirmation(n,Object.assign({},this.options,{onChange:e}));return i.start().then(function(){a.on("change",e),e()}),this},PreviewConfirmation.prototype.stop=function(){this.confirmation.stop()};